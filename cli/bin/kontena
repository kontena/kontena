#!/usr/bin/env ruby
# encoding: UTF-8

# resolve bin path, ignoring symlinks
require 'pathname'
bin_file = Pathname.new(__FILE__).realpath

libexec = bin_file.join('../../libexec')
if libexec.exist?
  # add libexec to gem path for homebrew installations
  ENV['GEM_PATH'] = libexec.to_s
  ENV['_HOMEBREW_TAG'] = "+homebrew"
  head = libexec.to_s.split(File::SEPARATOR).detect { |component| component.start_with?('HEAD') }
  ENV['_HOMEBREW_HEAD'] = head.nil? ? nil : ".pre.#{head.gsub("-", '').downcase}"
  Gem.paths = ENV
else
  # add self to libpath
  $:.unshift File.expand_path('../../lib', bin_file)
end

STDOUT.sync = true

require 'kontena_cli'

Kontena::PluginManager.instance.init
Kontena::MainCommand.run
