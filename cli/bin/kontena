#!/usr/bin/env ruby
# encoding: UTF-8

# resolve bin path, ignoring symlinks
require 'pathname'
bin_file = Pathname.new(__FILE__).realpath

# Homebrew formula installs gems to libexec
libexec = bin_file.join('../../libexec')
if libexec.exist?
  ENV['GEM_PATH'] = libexec.to_s
  ENV['_KONTENA_HOMEBREW'] = "true"
  Gem.paths = ENV
  $:.unshift Dir[libexec.join('gems/kontena-cli-*.*.*/lib')].first
else
  # add self to libpath
  $:.unshift File.expand_path('../../lib', bin_file)
end

STDOUT.sync = true

if ARGV[0] == 'complete'
  ARGV.delete_at(0)
  require 'kontena/scripts/completer'
else
  require 'kontena_cli'
  Kontena::PluginManager.instance.init
  Kontena::MainCommand.run
end
